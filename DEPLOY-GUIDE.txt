================================================================================
                        ë°°í¬ ê°€ì´ë“œ (ê°„ë‹¨ ë²„ì „)
================================================================================

GitHub: https://github.com/Kontrack/library
Domain: https://library.kontrack.kr

================================================================================
ğŸ“‹ ë°°í¬ ìˆœì„œ (ì²˜ìŒ 1íšŒ)
================================================================================

1ë‹¨ê³„: ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  chmod +x *.sh
  ./deploy.sh
  â†’ ì˜µì…˜ 1 ì„ íƒ (í”„ë¡œë•ì…˜ ë°°í¬)

  ìë™ ì‹¤í–‰ ë‚´ìš©:
  âœ“ public í´ë”ë¥¼ /usr/share/nginx/html/library/ ë¡œ ë³µì‚¬
  âœ“ MySQL ì»¨í…Œì´ë„ˆ ì‹œì‘ (í¬íŠ¸ 3307)


2ë‹¨ê³„: Docker ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì¶”ê°€ (ìˆ˜ë™)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Kontrack í”„ë¡œì íŠ¸ì˜ docker-compose.yml í¸ì§‘
  sudo nano ~/kontrack/upbit_auto_trading/docker-compose.yml
  
  # nginx serviceì˜ volumes ì„¹ì…˜ì— ë‹¤ìŒ ë¼ì¸ ì¶”ê°€:
  - /usr/share/nginx/html/library:/usr/share/nginx/html/library:ro
  
  # ì €ì¥ í›„ ì¢…ë£Œ (Ctrl+O, Enter, Ctrl+X)


3ë‹¨ê³„: Nginx ì„¤ì • ì¶”ê°€ (ìˆ˜ë™)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # ê¸°ì¡´ Kontrack í”„ë¡œì íŠ¸ì˜ Nginx ì„¤ì • ì—´ê¸°
  sudo nano ~/kontrack/upbit_auto_trading/nginx.conf

  # nginx-library-config.txt íŒŒì¼ì˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ
  # http { ... } ë¸”ë¡ ë‚´ ë§ˆì§€ë§‰ server ë¸”ë¡ ë‹¤ìŒì— ë¶™ì—¬ë„£ê¸°
  
  ë‚´ìš©:
  - HTTP â†’ HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸ (80 â†’ 443)
  - HTTPS server ë¸”ë¡
  - SSL ì¸ì¦ì„œ ê²½ë¡œ (ì´ë¯¸ ë°œê¸‰ë¨)
  - root /usr/share/nginx/html/library;

  # ì €ì¥ í›„ ì¢…ë£Œ (Ctrl+O, Enter, Ctrl+X)


4ë‹¨ê³„: Nginx ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Kontrack í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
  cd ~/kontrack/upbit_auto_trading
  
  # Nginx ì»¨í…Œì´ë„ˆë§Œ ì¬ì‹œì‘ (ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ì˜í–¥ ì—†ìŒ)
  docker-compose up -d nginx
  
  # Library í”„ë¡œì íŠ¸ë¡œ ëŒì•„ì˜¤ê¸°
  cd ~/library


5ë‹¨ê³„: í™•ì¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # ìƒíƒœ í™•ì¸
  ./health.sh

  # ì›¹ ì ‘ì†
  https://library.kontrack.kr


================================================================================
ğŸ”„ ì½”ë“œ ì—…ë°ì´íŠ¸ (í‰ì†Œ)
================================================================================

  # ë¡œì»¬ì—ì„œ ìˆ˜ì • í›„
  git push

  # ì„œë²„ì—ì„œ (ìë™ìœ¼ë¡œ ì›¹ íŒŒì¼ ë³µì‚¬ + MySQL ì¬ì‹œì‘)
  ./update.sh


================================================================================
ğŸ“ nginx-library-config.txt ë‚´ìš©
================================================================================

ë‹¤ìŒ ë‚´ìš©ì„ ê¸°ì¡´ nginx.confì˜ http ë¸”ë¡ ë‚´ì— ì¶”ê°€:

# ë„ì„œê´€ ì›¹ì‚¬ì´íŠ¸ (library.kontrack.kr) - HTTP â†’ HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸
server {
    listen 80;
    server_name library.kontrack.kr;
    return 301 https://$server_name$request_uri;
}

# ë„ì„œê´€ ì›¹ì‚¬ì´íŠ¸ (library.kontrack.kr) - HTTPS
server {
    listen 443 ssl http2;
    server_name library.kontrack.kr;

    # SSL ì¸ì¦ì„œ (ì´ë¯¸ ë°œê¸‰ë¨)
    ssl_certificate /etc/letsencrypt/live/library.kontrack.kr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/library.kontrack.kr/privkey.pem;

    # SSL ì„¤ì •
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    # ë£¨íŠ¸ ë””ë ‰í† ë¦¬
    root /usr/share/nginx/html/library;
    index index.html;

    # ì •ì  íŒŒì¼ ìºì‹±
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # SPA ë¼ìš°íŒ…
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 404 ì—ëŸ¬ í˜ì´ì§€
    error_page 404 /index.html;
}


================================================================================
âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
================================================================================

ìµœì´ˆ ë°°í¬:
  â–¡ chmod +x *.sh
  â–¡ ./deploy.sh (ì˜µì…˜ 1)
  â–¡ sudo nano ~/kontrack/upbit_auto_trading/docker-compose.yml
  â–¡ nginx volumesì— library ë§ˆìš´íŠ¸ ì¶”ê°€
  â–¡ sudo nano ~/kontrack/upbit_auto_trading/nginx.conf
  â–¡ nginx-library-config.txt ë‚´ìš© ë¶™ì—¬ë„£ê¸°
  â–¡ cd ~/kontrack/upbit_auto_trading
  â–¡ docker-compose up -d nginx
  â–¡ ./health.sh ë¡œ í™•ì¸
  â–¡ https://library.kontrack.kr ì ‘ì† í…ŒìŠ¤íŠ¸

ì½”ë“œ ì—…ë°ì´íŠ¸:
  â–¡ git push (ë¡œì»¬)
  â–¡ ./update.sh (ì„œë²„)
  â–¡ ./health.sh ë¡œ í™•ì¸


================================================================================
ğŸ” í™•ì¸ ëª…ë ¹ì–´
================================================================================

# ì›¹ íŒŒì¼ ìœ„ì¹˜
ls -la /usr/share/nginx/html/library/

# Nginx ì„¤ì • í™•ì¸
sudo nginx -t
cat /etc/nginx/nginx.conf | grep library

# MySQL í™•ì¸
docker-compose ps library-mysql

# ì›¹ ì ‘ì† í…ŒìŠ¤íŠ¸
curl -I https://library.kontrack.kr


================================================================================
â“ FAQ
================================================================================

Q: nginx-library-config.txtë¥¼ ì–´ë””ì— ë¶™ì—¬ë„£ë‚˜ìš”?
A: ê¸°ì¡´ nginx.confì˜ http { } ë¸”ë¡ ë‚´, ë§ˆì§€ë§‰ server ë¸”ë¡ ë‹¤ìŒì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.

Q: SSL ì¸ì¦ì„œëŠ”?
A: ì´ë¯¸ ë°œê¸‰ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë³„ë„ ì‘ì—… ë¶ˆí•„ìš”í•©ë‹ˆë‹¤.

Q: í¬íŠ¸ëŠ”?
A: HTTP 80, HTTPS 443 (ì›¹), MySQL 3307

Q: ì—…ë°ì´íŠ¸ í›„ Nginxë„ ì¬ì‹œì‘í•´ì•¼ í•˜ë‚˜ìš”?
A: ì•„ë‹ˆìš”. update.shëŠ” ì›¹ íŒŒì¼ë§Œ ë³µì‚¬í•˜ê³  MySQLë§Œ ì¬ì‹œì‘í•©ë‹ˆë‹¤.
   í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì •ì´ë¯€ë¡œ Nginx ì¬ì‹œì‘ ë¶ˆí•„ìš”í•©ë‹ˆë‹¤.

Q: Kontrack Nginxì— ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì— ì˜í–¥ì´ ìˆë‚˜ìš”?
A: ì•„ë‹ˆìš”. ì¶”ê°€ë˜ëŠ” ë§ˆìš´íŠ¸ëŠ” ë…ë¦½ì ì…ë‹ˆë‹¤:
   - ê¸°ì¡´: ../../../:/usr/share/nginx/html:ro (kontrack, api, chat, ser)
   - ì¶”ê°€: /usr/share/nginx/html/library:/usr/share/nginx/html/library:ro (libraryë§Œ)
   ê° ë§ˆìš´íŠ¸ëŠ” ë…ë¦½ì ì´ë¯€ë¡œ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.

Q: ë³¼ë¥¨ ë§ˆìš´íŠ¸ëŠ” ì–´ë””ì— ì¶”ê°€í•˜ë‚˜ìš”?
A: ~/kontrack/upbit_auto_trading/docker-compose.yml íŒŒì¼ì˜
   nginx service â†’ volumes ì„¹ì…˜ì— ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.


================================================================================
                            ë°°í¬ ê°€ì´ë“œ ë
================================================================================

